var redis = require('redis').createClient();
var async = require('asyncawait/async');
var await = require('asyncawait/await');




exports.initTable = async(function(options) {
        await(function(done) {
            redis.hmset('table:' + options.tableId, {'id':options.tableId, 'stage':options.stage}, done);
        });

        await(function(done) {
            redis.sadd('table:' + options.tableId + ':deck', options.deck, done)
        });
    });

exports.initPlayers = async(function(options) {
    options.players.forEach(function(player) {
        await(function(done) {
            redis.hmset('user:' + player.id, {
                'id': player.id,
                'name': player.name
            }, done)
        });
        await(function(done) {
            redis.sadd('table:' + options.tableId + ':users', player.id, done)
        })
    })
});

exports.getUserCard = async(function(options) {
    options.players.forEach(function(player) {
        var card = await(function(done) {
            redis.spop('table:' + options.tableId + ':deck', done);
        });
        await(function(done) {
            redis.sadd('user:' + player.id + ':cards', card, done)
        });
        console.log('cardToUser: ' + card)
    })
});

exports.getBoardCard = async(function(options) {
    var card = await(function(done) {
        redis.spop('table:' + options.tableId + ':deck', done)
    });
    await(function(done) {
        redis.sadd('table:' + options.tableId + ':board', card, done);
    });
    console.log('cardToBoard:' + card)
});








